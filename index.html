<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>活動銷量監控</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0f0f0f] text-zinc-200 p-6 min-h-screen">
    <div class="max-w-xl mx-auto">
        <h1 class="text-2xl font-black text-sky-400 mb-6 uppercase tracking-tighter">Event Monitor</h1>
        
        <div id="display-area" class="space-y-4">
            <div class="text-zinc-700 italic text-center py-20">正在連線至數據庫...</div>
        </div>
    </div>

    <script>
        async function fetchData() {
            const area = document.getElementById('display-area');
            if (!area) return; // 安全防護

            try {
                // 強制跳過快取抓取最新 JSON
                const res = await fetch(`list.json?nocache=${Date.now()}`);
                if (!res.ok) throw new Error("尚未生成數據檔案");

                const data = await res.json();
                const list = data.products || [];

                if (list.length === 0) {
                    area.innerHTML = '<div class="text-center text-zinc-600 border border-dashed border-zinc-800 p-10 rounded-2xl">目前沒有符合括號格式的活動</div>';
                    return;
                }

                area.innerHTML = list.map(p => `
                    <div class="bg-zinc-900 border border-zinc-800 p-5 rounded-2xl flex justify-between items-center shadow-xl">
                        <div class="flex-1 pr-4">
                            <div class="text-white font-bold text-sm mb-1">${p.title}</div>
                            <div class="text-[10px] text-zinc-500 font-mono">UUID: ${p.productUuid.substring(0,8)}...</div>
                        </div>
                        <div class="text-right">
                            <div class="text-amber-500 font-black text-lg">${p.totalSalesQuantity || 0}</div>
                            <div class="text-[9px] text-zinc-600 uppercase font-bold">Sales</div>
                        </div>
                    </div>
                `).join('');

            } catch (err) {
                area.innerHTML = `<div class="text-zinc-800 text-sm text-center py-10 italic">${err.message}<br>請先去 K-Monstar 首頁重新觸發同步</div>`;
            }
        }

        // 啟動與定時更新
        fetchData();
        setInterval(fetchData, 30000);
    </script>
</body>
</html>