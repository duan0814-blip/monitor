<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ITZY éŠ·é‡å¯¦æ™‚æˆ°å ± - æœ€çµ‚ç‰ˆ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #e0e0e0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 600px; background: #1e1e1e; padding: 25px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.7); border: 1px solid #333; }
        h1 { text-align: center; color: #bb86fc; margin-bottom: 5px; letter-spacing: 2px; }
        .subtitle { text-align: center; font-size: 13px; color: #777; margin-bottom: 30px; }
        .rank-item { display: flex; align-items: center; padding: 18px; margin-bottom: 15px; border-radius: 12px; background: #2c2c2c; border-left: 6px solid #bb86fc; transition: transform 0.2s; }
        .rank-item:hover { transform: translateY(-3px); background: #333; }
        .rank-num { font-size: 26px; font-weight: bold; width: 50px; color: #555; text-align: center; }
        .rank-name { flex-grow: 1; font-size: 18px; font-weight: 500; }
        .rank-qty { font-size: 22px; font-weight: bold; color: #ff5252; margin-left: 20px; }
        .percentage-bar { height: 8px; background: #121212; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .fill { height: 100%; background: linear-gradient(90deg, #bb86fc, #03dac6); transition: width 1.5s ease-in-out; }
        .update-time { text-align: center; font-size: 11px; color: #444; margin-top: 25px; text-transform: uppercase; }
        .top1 { border-left: 6px solid #ffd700; background: #2d2a20; }
        .top1 .rank-num { color: #ffd700; }
        .top1 .rank-name { color: #ffd700; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ’œ ITZY éŠ·é‡å¯¦æ™‚æˆ°å ±</h1>
    <div class="subtitle">æ•¸æ“šå·²é€£ç·šï¼šGoogle é›²ç«¯å¯¦æ™‚ç›£æ§</div>

    <div id="rank-list">
        <div style="text-align:center; padding: 50px; color: #bb86fc;">åŒæ­¥æ•¸æ“šä¸­...</div>
    </div>
    
    <div class="update-time" id="sync-time">WAITING FOR UPDATE...</div>
</div>

<script>
    // ä½¿ç”¨æ‚¨æä¾›çš„æ­£ç¢º CSV ç¶²å€
    const FINAL_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ0rAQMNppJpAL6oSUnkYvwoG-Depb5SxKqrLeQ5wLqA83Y3pCcGyC43KY-wNUocldItAl9z2LBNv1Y/pub?output=csv';

    async function refreshBoard() {
        try {
            // æŠ“å– CSV æ•¸æ“š
            const res = await fetch(`${FINAL_CSV_URL}&t=${Date.now()}`);
            const text = await res.text();
            
            // è§£æ CSV è¡Œ
            const rows = text.split(/\r?\n/).slice(1);
            let summary = {};

            rows.forEach(row => {
                const cols = row.split(',');
                if (cols.length < 5) return;
                
                // æ¬„ä½å°æ‡‰ï¼šcols[1] æ˜¯å•†å“å, cols[4] æ˜¯æœ¬æ¬¡å·®ç•°
                const name = cols[1].replace(/"/g, '').trim();
                const diff = parseInt(cols[4]) || 0;

                if (name) {
                    summary[name] = (summary[name] || 0) + diff;
                }
            });

            // æ’åº
            const dataList = Object.entries(summary)
                .map(([name, qty]) => ({ name, qty }))
                .sort((a, b) => b.qty - a.qty);

            if (dataList.length === 0) {
                document.getElementById('rank-list').innerHTML = "<div style='text-align:center; color:#555;'>å°šæœªåµæ¸¬åˆ°éŠ·é‡è®Šå‹•</div>";
                return;
            }

            // æ¸²æŸ“ä»‹é¢
            const maxVal = dataList[0].qty || 1;
            let htmlString = '';
            
            dataList.forEach((item, i) => {
                const width = (item.qty / maxVal) * 100;
                htmlString += `
                    <div class="rank-item ${i === 0 ? 'top1' : ''}">
                        <div class="rank-num">${i + 1}</div>
                        <div class="rank-name">
                            ${item.name}
                            <div class="percentage-bar"><div class="fill" style="width: ${width}%"></div></div>
                        </div>
                        <div class="rank-qty">${item.qty}</div>
                    </div>`;
            });

            document.getElementById('rank-list').innerHTML = htmlString;
            document.getElementById('sync-time').innerText = `LAST SYNC: ${new Date().toLocaleString()}`;

        } catch (err) {
            console.error(err);
            document.getElementById('rank-list').innerHTML = "<div style='color:red; text-align:center;'>é€£ç·šä¸­æ–·ï¼Œè«‹æª¢æŸ¥ç¶²è·¯</div>";
        }
    }

    // å•Ÿå‹•ï¼šæ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œä¿æŒæœ€é«˜å¯¦æ™‚æ€§
    refreshBoard();
    setInterval(refreshBoard, 10000);
</script>

</body>
</html>