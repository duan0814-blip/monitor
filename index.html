<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŠ·é‡è§€æ¸¬ - by Duan</title>
    <style>
        :root { --primary: #bb86fc; --bg: #0a0a0a; --surface: #1a1a1a; }
        body { font-family: sans-serif; background: var(--bg); color: white; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; }
        header { text-align: center; padding: 40px 0; }
        h1 { margin: 0; color: var(--primary); font-size: 28px; }
        .source-link { color: #03dac6; text-decoration: none; font-size: 14px; }
        
        .event-card { background: var(--surface); border-radius: 12px; padding: 20px; margin-bottom: 15px; border: 1px solid #333; }
        .event-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; line-height: 1.4; }
        .event-time { font-size: 13px; color: #888; margin-bottom: 20px; }
        
        .view-btn { 
            display: inline-block; background: var(--primary); color: #000; 
            padding: 10px 25px; border-radius: 25px; text-decoration: none; 
            font-weight: bold; transition: 0.3s;
        }
        .view-btn:hover { opacity: 0.8; transform: scale(1.05); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>éŠ·é‡è§€æ¸¬</h1>
        <a href="https://kmonstar.org/" target="_blank" class="source-link">æ•¸æ“šä¾†æºï¼šK-Monstar åœ‹éš›</a>
    </header>

    <div id="event-list">
        <div style="text-align:center; color:#666;">ğŸ“¡ æ­£åœ¨ç¢ºèªæ´»å‹•ç‹€æ…‹...</div>
    </div>
</div>

<script>
    async function loadEvents() {
        try {
            // è®€å–ç”± Actions æŠ“å–çš„ç”¢å“åˆ—è¡¨ [cite: 2025-12-17]
            const res = await fetch(`list.json?t=${Date.now()}`);
            const json = await res.json();
            const now = new Date();
            
            // ç¯©é¸æ­£åœ¨é€²è¡Œä¸­çš„æ´»å‹•
            const ongoing = json.data.products.filter(p => {
                const start = new Date(p.eventApplyStartAt);
                const end = new Date(p.eventApplyEndAt);
                return now >= start && now <= end;
            });

            render(ongoing);
        } catch (e) {
            document.getElementById('event-list').innerHTML = "âŒ ç„¡æ³•è¼‰å…¥æ´»å‹•åˆ—è¡¨";
        }
    }

    function render(events) {
    const container = document.getElementById('event-list');
    if (events.length === 0) {
        container.innerHTML = "<div style='text-align:center; padding:50px; color:#888;'>â˜• ç›®å‰æš«ç„¡é€²è¡Œä¸­çš„æ´»å‹•</div>";
        return;
    }

    container.innerHTML = events.map(ev => {
        // ç°¡å–®æå–æ‹¬è™Ÿå…§çš„æ—¥æœŸèˆ‡æ¨™é¡Œ
        const titleMatch = ev.title.match(/\(([^)]+)\)\s*(.*)/);
        const dateTag = titleMatch ? titleMatch[1] : 'EVENT';
        const cleanTitle = titleMatch ? titleMatch[2] : ev.title;

        return `
            <div class="event-card">
                <div style="font-size:12px; color:var(--primary); margin-bottom:5px;">ğŸ“… æ´»å‹•æ—¥æœŸï¼š20${dateTag.substring(0,2)}/${dateTag.substring(2,4)}/${dateTag.substring(4,6)}</div>
                <div class="event-title">${cleanTitle}</div>
                <div class="event-time">
                    ğŸ›’ æ‡‰å‹Ÿæˆªæ­¢ï¼š${new Date(ev.eventApplyEndAt).toLocaleString()}
                    <br>ğŸ“Š ç›®å‰ç¸½éŠ·é‡ï¼š<strong>${ev.totalSalesQuantity}</strong>
                </div>
                <a href="report.html?id=${ev.optionUuid}" class="view-btn">æŸ¥çœ‹éŠ·é‡æˆ°å ±</a>
            </div>
        `;
    }).join('');
}

    loadEvents();
</script>

</body>
</html>