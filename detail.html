<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成員銷量戰報</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: sans-serif; }
        .bar-container { background-color: #1e1e1e; border: 1px solid #333; }
        .bar-fill { transition: width 1s ease-out; height: 100%; border-radius: 4px; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-2xl mx-auto">
        <a href="index.html" class="text-purple-400 hover:text-purple-300 mb-6 inline-block">← 返回列表</a>
        
        <header class="mb-10">
            <h1 id="prod-name" class="text-2xl md:text-3xl font-bold text-white mb-2">正在載入戰報...</h1>
            <div class="flex justify-between items-center text-gray-400">
                <p>總銷量：<span id="total-sales" class="text-yellow-500 font-bold text-xl">0</span></p>
                <p id="update-time" class="text-xs"></p>
            </div>
        </header>

        <div id="member-stats" class="space-y-6">
            </div>
    </div>

    <script>
        async function loadDetail() {
            // 從網址取得 uuid (例如 detail.html?id=xxxx)
            const params = new URLSearchParams(window.location.search);
            const uuid = params.get('id');
            if (!uuid) return;

            try {
                const response = await fetch(`./product_${uuid}.json?t=` + Date.now());
                const data = await response.json();

                document.getElementById('prod-name').innerText = data.title || data.name;
                document.getElementById('total-sales').innerText = data.totalSales || data.total;
                
                const members = data.members || [];
                const container = document.getElementById('member-stats');
                container.innerHTML = '';

                // 計算最大銷量作為比例基準
                const maxSales = Math.max(...members.map(m => m.sales), 1);

                members.sort((a, b) => b.sales - a.sales).forEach(m => {
                    const percentage = (m.sales / maxSales) * 100;
                    const item = document.createElement('div');
                    item.className = 'space-y-2';
                    item.innerHTML = `
                        <div class="flex justify-between text-sm">
                            <span class="font-bold text-gray-200">${m.name}</span>
                            <span class="text-purple-400">${m.sales} 張</span>
                        </div>
                        <div class="w-full h-4 bg-gray-800 rounded-full overflow-hidden bar-container">
                            <div class="bar-fill bg-gradient-to-r from-purple-600 to-teal-400" style="width: 0%" data-w="${percentage}"></div>
                        </div>
                    `;
                    container.appendChild(item);
                });

                // 觸發動畫
                setTimeout(() => {
                    document.querySelectorAll('.bar-fill').forEach(bar => {
                        bar.style.width = bar.getAttribute('data-w') + '%';
                    });
                }, 100);

            } catch (e) {
                document.getElementById('prod-name').innerText = "尚未取得該商品詳細數據";
            }
        }
        window.onload = loadDetail;
    </script>
</body>
</html>